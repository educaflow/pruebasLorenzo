<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.1.xsd">


    <menuitem name="prueba-dashboard-menu" title="Prueba Búsqueda" action="prueba-dashboard-action" groups="admins,users" order="999"/>

    <action-view name="prueba-dashboard-action" title="Prueba de Búsqueda">
        <view type="dashboard" name="ver-expedientes-dashboard"/>
    </action-view>

    <dashboard name="ver-expedientes-dashboard" title="Expedientes" onInit="ver-expedientes-oninit-action"  searchModel="com.educaflow.apps.expedientes.db.SearchExpedientes">
        <search-fields>
            <field name="estado" widget="boolean-radio" x-true-text="Cerrado" x-false-text="Abierto" />
            <field name="anyo" type="integer" title="Año" />
        </search-fields>

        <dashlet   action="expedientes-buscar-action"/>
    </dashboard>


    <action-view name="expedientes-buscar-action" title="Buscando expedientes" model="com.educaflow.apps.expedientes.db.Expediente">
        <view type="tree" name="expedientes-buscar-tree"/>
        <context name="_profile" expr="RESPONSABLE"/>
    </action-view>


    <action-record name="ver-expedientes-oninit-action" model="com.educaflow.apps.expedientes.db.SearchExpedientes" >
        <field name="estado" expr="eval: true" />
        <field name="anyo" expr="eval: java.time.Year.now().value" />
    </action-record>

    <tree name="expedientes-buscar-tree" title="Expedientes">

        <column name="name"/>
        <column name="numeroExpediente" width="100px" title="Num. Exp."/>
        <column name="createdBy" width="200px" title="Creado por"/>
        <column name="nameState" width="30%" title="Estado"/>
        <column name="fechaUltimoEstado" type="date" width="100px" title="Fecha"/>


        <node model="com.educaflow.apps.expedientes.db.Tramite" domain="EXISTS (SELECT 1 FROM Expediente e WHERE e.closed=:estado and ((:anyo is null) OR (:anyo=0) OR (YEAR(e.fechaUltimoEstado)=:anyo)) AND e.tipoExpediente.tramite=self)" >
            <field name="name" as="name"/>
        </node>

        <node model="com.educaflow.apps.expedientes.db.Expediente" domain="(self.closed=:estado) and ((:anyo is null) OR (:anyo=0) OR (YEAR(self.fechaUltimoEstado)=:anyo))" parent="tipoExpediente.tramite" draggable="false" onClick="action-event-view-expediente">
            <field name="name"/>
            <field name="numeroExpediente"/>
            <field name="createdBy"/>
            <field name="nameState"/>
            <field name="fechaUltimoEstado"/>
        </node>

    </tree>








</object-views>